<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Twitch Shout-out Clips Player</title>
    <meta name="description" content="Twitch Shout out clip player. !so channelname. This will display a random clip and say a shout out message in chat." />
    <meta name="keywords" content="Twitch, shoutout, chat bot, overlay" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Twitch Shout-out Clips Player" />
    <meta property="og:description" content="Twitch Shout out clip player. !so channelname. This will display a random clip and say a shout out message in chat." />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="Twitch Shout-out Clips Player" />
    <script src="assets/js/jquery-3.6.0.min.js"></script>
    <script src="assets/js/bootstrap.bundle.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <link rel="stylesheet" href="assets/css/bootstrap452.min.css">
    <link rel="stylesheet" href="assets/css/dark.min.css">
    <link rel="apple-touch-icon" sizes="57x57" href="assets/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="assets/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="assets/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="assets/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="assets/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="assets/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="assets/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
</head>
<style>
    .hide {
        display: none;
    }
    .ml-0 {
        margin-left: 0 !important;
    }
    .ml-4 {
        margin-left: 1.5rem !important;
    }
    .pl-0 {
        padding-left: 0 !important;
    }
    .pr-0 {
        padding-right: 0 !important;
    }
    .dark-blue {
        background-color: #1b2836 !important;
        color: #fff !important;
    }
    .light-blue {
        background-color: #354e69 !important;
        color: #fff !important;
    }
</style>
<body onload="onInit()">
<div class="container">
    <div class="row pt-md-4">
        <ul class="nav nav-pills">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle active" data-toggle="dropdown" href="#" role="button"
                   aria-haspopup="true" aria-expanded="false">Twitch Tools</a>
                <div class="dropdown-menu" id="main-nav">
                </div>
            </li>
        </ul>
    </div>
    <div class="row">
        <div class="col-10">
            <h1 class="h3 pt-4 pl-lg-4 text-center">Twitch Shout-out</h1>
        </div>
        <div class="col-2 text-center">
            <img src="assets/images/robot.gif" style="width: 60px;" alt="tekbot_v1" title="Hi, I'm tekbot_v1" id="tekbotImg" onmouseover="onHover();" onmouseout="offHover();">
        </div>
    </div>
    <ul class="nav nav-tabs" id="mainNav" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="home-tab" href="index.html" role="tab">Clips</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="profile-tab" href="slider.html" role="tab">Slider</a>
        </li>
    </ul>
    <br>
    <div class="card">
        <div class="card-body">
            <a class="github-button" href="https://github.com/teklynk/twitch_shoutout/fork" data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large" data-show-count="true" aria-label="">Fork</a>
            <a class="github-button" href="https://github.com/teklynk/twitch_shoutout" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="">Star</a>
            <h2>Shout-Out Clip Player Overlay</h2>
            <p>Play a random clip from the streamers channel that is shouted out.</p>
            <h3>Notes:</h3>
            <ul>
                <li><span class="text-info"><strong>FEATURES:</strong></span></li>
                <li><strong>!watchclip</strong> Play a clip that was posted into chat.</li>
                <li><strong>!replayso, !soreplay, !clipreplay, !replayclip</strong> will replay the previous shout-out clip. Maybe you just have to see that clip again :)</li>
                <li><strong>!stopclip</strong> to stop/reload the browser source in case a clip is just way too long, cringey or playing at an inappropriate time. Limited to Mods and Streamer. Can also use (!sostop, !stopclip, !clipstop, !clipreload)</li>
                <li><strong>Date Range option:</strong> This will grab a clip from within the last 5days, 10day, 30days... If no clips exist, then no clip will play. You can enable the "Show the user profile image" to display the users avatar in place of a non-existent clip.</li>
                <li>
                    <strong>Show clip details panel:</strong> This will display a panel in the lower third of the overlay that contains details about the clip. This can use variables:{channel},{title},{game},{creator_name},{created_at}.
                </li>
                <li>Automatically do a shout-out on Raid events.</li>
                <li>You can not do a shout-out while another shout-out is playing. The command will simply be ignored.</li>
                <li>Be sure to set "Shutdown source when not visible", "Control audio via OBS", "Refresh browser when scene becomes active" on the OBS Browser Source properties.
                </li>
            </ul>
        </div>
    </div>
    <br>
    <div class="card dark-blue">
        <div class="card-body">
            <h5 class="card-title">Supporting This Project</h5>
            <p class="card-text">
                As a volunteer developer, I'm proud to maintain and improve this open-source project. To continue providing a reliable and feature-rich experience, I need your help. Our backend server, which fetches API data, incurs costs that need to be covered.
            </p>
            <p>
                If you find this project valuable and enjoy using it, please consider making a donation to help offset these expenses. Your contribution will directly support the project's growth and ensure its continued availability.
            </p>
            <span class="text-info">Your Donation Will Help</span>
            <ul>
                <li>Keep the server running smoothly</li>
                <li>Cover costs and maintenance</li>
                <li>Support ongoing development and improvements</li>
                <li>Ensure a reliable experience for all users</li>
            </ul>
            <p>
                Thank you for your support, and I'm grateful for your enthusiasm for this project.
            </p>
            <p>
                If you need more details on how to donate or have any questions, feel free to ask.
            </p>
            <div class="text-left mt-4">
                <div class="btn-container ml-0 pl-0">
                    <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
                    <script type='text/javascript'>kofiwidget2.init('Donate', '#191d21', 'O4O0BWF2E');kofiwidget2.draw();</script>
                </div>
                <div class="btn-container">
                    <script type='text/javascript' src="https://liberapay.com/teklynkliberapay/widgets/button.js"></script>
                    <noscript><a href="https://liberapay.com/teklynkliberapay/donate"><img alt="Donate using Liberapay" src="https://liberapay.com/assets/widgets/donate.svg"></a></noscript>
                </div>
                <div class="btn-container btn btn-link">
                    <a href="https://www.paypal.com/donate/?hosted_button_id=UVKZUYFMXQDPL" target="_blank">Paypal</a>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="form-label-group mb-2">
        <label for="mainAccount">Twitch Account</label>
        <input type="text" id="mainAccount" class="form-control validate" placeholder="MrCoolStreamer">
    </div>
    <h2>Options</h2>
    <div class="form-label-group mb-2">
        <label for="command">Custom Command
            <small>(so, soclip, playclip. No need to include the ! symbol)</small>
        </label>
        <input type="text" id="command" class="form-control validate" value="so" placeholder="so" size="50">
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="showClip" checked>
        <label class="form-check-label" for="showClip">
            Show clip
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="showImage">
        <label class="form-check-label" for="showImage">
            Show the user profile image if clips do not exist
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="raided">
        <label class="form-check-label" for="raided">
            Automatically shoutout a streamer when they raid you.
        </label>
    </div>
    <div class="form-group range-slider hide ml-4 mr-4 mt-2" id="so_count">
        <label for="delay">Min raid party size
        </label>
        <input type="range" max="30" min="0" step="1" class="form-control range-slider-range" id="raidCount"
               value="3" style="height: 0;">
        <small class="text-muted range-slider-value"></small>
        <small class="text-muted range-slider-value">Users</small>
    </div>
    <div class="form-group range-slider hide ml-4 mr-4" id="so_delay">
        <label for="delay">Delay automatic shoutout
        </label>
        <input type="range" max="30" min="1" step="1" class="form-control range-slider-range" id="delay"
               value="10" style="height: 0;">
        <small class="text-muted range-slider-value"></small>
        <small class="text-muted range-slider-value">Seconds</small>
    </div>
    <div class="form-group range-slider mt-2">
        <label for="dateRange">Only show clips from within a Date Range <small>(Optional)</small> <small class="text-warning">* 0 Day(s) = OFF</small>
        </label>
        <input type="range" max="365" min="0" step="1" class="form-control range-slider-range" id="dateRange"
               value="0" style="height: 0;">
        <small class="text-muted range-slider-value" id="date-limit"></small>
        <small class="text-muted range-slider-value">Day(s)</small>
    </div>
    <div class="form-group range-slider">
        <label for="timeOut">Max Duration Time
            <small>(How long should the clip play?)</small>
        </label>
        <input type="range" max="120" min="1" step="1" class="form-control range-slider-range" id="timeOut"
               value="10" style="height: 0;">
        <small class="text-muted range-slider-value"></small>
        <small class="text-muted range-slider-value">Seconds</small>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="showText" checked>
        <label class="form-check-label" for="showText">
            Show: "Go check out {channel}" on top of the clip
        </label>
        <div class="form-label-group mb-4 hide" id="customTitle_block">
            <div class="form-label-group mb-4 mt-2">
                <label for="customTitle">Custom Title
                    <small>(Optional)</small>
                </label>
                <input type="text" id="customTitle" class="form-control" value=""
                       placeholder="Go check out {channel} {url}" size="50">
            </div>
        </div>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" value="" id="showDetails">
        <label class="form-check-label" for="showDetails">
            Show clip details panel
        </label>
    </div>
    <div class="form-label-group mt-2 mb-4 ml-4 hide" id="showDetailsText">
        <label for="detailsText">Custom clip details panel text <small>(Optional)</small>
        </label>
        <textarea class="form-control" id="detailsText" rows="4" placeholder="{title}
While streaming {game}
Clipped by {creator_name} {created_at}"></textarea>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" value="" id="showMsg">
        <label class="form-check-label" for="showMsg">
            Show chat message: "Go check out {channel}! - They were playing: {game} - {title} - {url}"
            <small class="text-warning">* Requires Twitch Access Token</small>
        </label>
        <div class="form-label-group mb-4 hide" id="access_token">
            <div class="form-label-group mb-4 mt-2">
                <label for="customMsg">Custom Message
                    <small>(Optional)</small>
                </label>
                <input type="text" id="customMsg" class="form-control" value=""
                       placeholder="Go check out {channel}! - They were playing: {game} - {title} - {url}" size="50">
            </div>
            <div class="mb-2 mt-2">
                <a href="https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=gl1cjo1kdgsmj7lwjajhnb2lireyus&redirect_uri=https://twitch-shoutout.pages.dev/&scope=chat:read+chat:edit&force_verify=true"
                   target="_self"><img src="assets/images/connect.png"></a>
            </div>
            <label for="ref">Access token</label>
            <input type="password" id="ref" class="form-control">
            <span id="show_ref"
                  style="cursor:pointer;text-align:left;display:inline-block;width:70px;margin-top: 4px;font-size:smaller;vertical-align:top;"
                  title="Show/Hide">show
        </span>
        </div>
    </div>
    <div class="form-check mb-2 mt-2">
        <input class="form-check-input" type="checkbox" value="" id="modsOnly" checked>
        <label class="form-check-label" for="modsOnly">
            Mods only
        </label>
    </div>
    <div class="form-group mt-4">
        <label for="themeOption">Theme options</label>
        <select class="form-control" id="themeOption">
            <option value="0">None</option>
            <option value="1">Slide in fancy skewed</option>
            <option value="2">Slide in basic</option>
            <option value="3">Outside the box</option>
        </select>
    </div>
    <br>
    <button class="btn btn-lg btn-success btn-block" id="generate_button" type="button">Generate Overlay Link</button>
    <br>
    <div id="overlaylink" class="hide"></div>
</div>
<script>
    function onInit() {

        let url = window.location.href;

        if (url.indexOf('#access_token') !== -1) {
            // extract the access_token from the url
            let access_token = new URL(url).hash.split('&').filter(function (el) {
                if (el.match('access_token') !== null) return true;
            })[0].split('=')[1];
            // fill input with token value
            document.getElementById("ref").value = access_token;
            // Save token to localstorage
            localStorage.setItem("TwitchSORef", access_token);
            // Redirect to default page after getting token
            window.location.href = "https://twitch-shoutout.pages.dev";
        } else {
            document.getElementById("ref").value = localStorage.getItem("TwitchSORef");
        }

        let rangeSlider = function rangeSlider() {
            let slider = $('.range-slider'),
                range = $('.range-slider-range'),
                value = $('.range-slider-value');

            slider.each(function () {

                value.each(function () {
                    let value = $(this).prev().attr('value');
                    $(this).html(value);
                });

                range.on('input', function () {
                    $(this).next(value).html(this.value);
                });
            });
        };

        rangeSlider();

        document.getElementById("mainAccount").value = localStorage.getItem("TwitchSOMainAccount");
        document.getElementById("customMsg").value = localStorage.getItem("TwitchSOCustomMsg");
        document.getElementById("customTitle").value = localStorage.getItem("TwitchSOCustomTitle");
        document.getElementById("ref").value = localStorage.getItem("TwitchSORef");

        if (document.getElementById("showText").checked) {
            document.getElementById("customTitle_block").classList.toggle('hide');
        }

        // show custom details input
        if (document.getElementById("showDetails").checked) {
            document.getElementById("showDetailsText").classList.toggle('hide');
        }

        if (document.getElementById("showMsg").checked) {
            document.getElementById("access_token").classList.toggle('hide');
        }

        if (document.getElementById("raided").checked) {
            document.getElementById("so_delay").classList.toggle('hide');
        }
    }

    // Check if any input fields have changed
    $(":text,:password,textarea,:checkbox,input[type=range]").on('change', function (e) {

        $("#overlaylink").addClass("hide");

        // Save the state of changes to localstorage so that they are not lost
        localStorage.setItem("TwitchSOMainAccount", document.getElementById("mainAccount").value.trim());
        localStorage.setItem("TwitchSORef", document.getElementById("ref").value.trim());
        localStorage.setItem("TwitchSOCustomMsg", document.getElementById("customMsg").value.trim());
        localStorage.setItem("TwitchSOCustomTitle", document.getElementById("customTitle").value.trim());
    });

    //show chat message
    document.getElementById("showMsg").addEventListener("click", function (e) {
        document.getElementById("access_token").classList.toggle('hide');
    }, false);

    document.getElementById("showText").addEventListener("click", function (e) {
        document.getElementById("customTitle_block").classList.toggle('hide');
    }, false);

    document.getElementById("showDetails").addEventListener("click", function (e) {
        document.getElementById("showDetailsText").classList.toggle('hide');
    }, false);

    document.getElementById("raided").addEventListener("click", function (e) {
        document.getElementById("so_delay").classList.toggle('hide');
        document.getElementById("so_count").classList.toggle('hide');
    }, false);

    document.getElementById("showClip").addEventListener("click", function (e) {
        document.getElementById("dateRange").disabled = false;
    }, false);

    document.getElementById("show_ref").addEventListener("click", function (e) {
        if (document.getElementById("show_ref").innerText === "hide") {
            document.getElementById("show_ref").innerText = "show";
            document.getElementById("ref").setAttribute('type', 'password');
        } else {
            document.getElementById("show_ref").innerText = "hide";
            document.getElementById("ref").setAttribute('type', 'text');
        }
    }, false);

    document.getElementById("generate_button").addEventListener("click", function (e) {
        let mainAccount = document.getElementById("mainAccount").value.trim();
        let ref = document.getElementById("ref").value.trim();
        let customMsg = document.getElementById("customMsg").value.trim();
        let customTitle = document.getElementById("customTitle").value.trim();
        let showClip = document.getElementById("showClip").checked;
        let modsOnly = document.getElementById("modsOnly").checked;
        let showMsg = document.getElementById("showMsg").checked;
        let showImage = document.getElementById("showImage").checked;
        let showText = document.getElementById("showText").checked;
        let showDetails = document.getElementById("showDetails").checked;
        let detailsText = document.getElementById("detailsText").value.trim();
        let timeOut = document.getElementById("timeOut").value.trim();
        let command = document.getElementById("command").value.trim();
        let dateRange = document.getElementById("dateRange").value.trim();
        let raided = document.getElementById("raided").checked;
        let raidCount = document.getElementById("raidCount").value.trim();
        let delay = document.getElementById("delay").value.trim();
        let themeOption = document.getElementById("themeOption").value;

        if (!mainAccount) {
            alert('Twitch username is not set');
        }

        if (!command) {
            alert('Shout-out command is not set!');
        }

        if (!showMsg) {
            ref = '';
        }

        if (showMsg && !ref) {
            alert('Twitch access token is required if show chat message is checked!');
        }

        if (showDetails && !detailsText) {
             detailsText = "{title}\nWhile streaming {game}\nClipped by {creator_name} {created_at}";
        }

        //build overlay url
        if (mainAccount) {
            let srcURL = window.location.protocol + "//" + window.location.host + window.location.pathname;
            let fullUrl = srcURL + "shoutout.html?channel=" + mainAccount.toLowerCase() + "&showClip=" + showClip + "&showMsg=" + encodeURIComponent(showMsg) + "&showText=" + showText + "&showImage=" + showImage + "&raided=" + raided + "&raidCount=" + raidCount + "&delay=" + delay + "&modsOnly=" + modsOnly + "&timeOut=" + timeOut + "&command=" + command + "&customMsg=" + encodeURIComponent(customMsg) + "&customTitle=" + encodeURIComponent(customTitle) + "&showDetails=" + showDetails + "&detailsText=" + encodeURIComponent(detailsText) + "&dateRange=" + dateRange + "&themeOption=" + themeOption + "&ref=" + btoa(ref);
            fullUrl = fullUrl.replace("index.htmlshoutout.html", "shoutout.html");
            document.getElementById("overlaylink").classList.remove("hide");
            document.getElementById("overlaylink").innerHTML = "<p>Add this link as a browser source in OBS.<br>" +
                "<a style='word-break:break-all;' href='" + fullUrl + "' target='_blank'>" + fullUrl + "</a><br><span class='text-warning'><small>* Never share this url with anyone or show it on stream!</small></span></p>";
        }
    });
</script>
<div class="text-right">
    <a class="btn btn-link" href="https://github.com/teklynk/twitch_shoutout/blob/main/README.md"
       target="_blank">Help</a>
    <a class="btn btn-link" href="https://github.com/teklynk/twitch_shoutout" target="_blank">Github</a>
    <div class="btn-container">
        <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
        <script type='text/javascript'>kofiwidget2.init('Donate', '#191d21', 'O4O0BWF2E');kofiwidget2.draw();</script>
    </div>
    <div class="btn-container">
        <script type='text/javascript' src="https://liberapay.com/teklynkliberapay/widgets/button.js"></script>
        <noscript><a href="https://liberapay.com/teklynkliberapay/donate"><img alt="Donate using Liberapay" src="https://liberapay.com/assets/widgets/donate.svg"></a></noscript>
    </div>
    <div class="btn-container btn btn-link">
        <a href="https://www.paypal.com/donate/?hosted_button_id=UVKZUYFMXQDPL" target="_blank">Paypal</a>
    </div>
</div>
<script>
    // tekbot_v1 mouse hover action
    function onHover() {
        $("#tekbotImg").attr('src', 'assets/images/robot_loop.gif');
    }
    function offHover() {
        $("#tekbotImg").attr('src', 'assets/images/robot.gif');
    }

    // Json data - Ajax call
    let nav_json = JSON.parse($.getJSON({
        'url': "https://twitchapi.teklynk.com/getnav.php",
        'async': false
    }).responseText);

    $.each(nav_json, function (i, val) {
        $('<a class="dropdown-item" href="' + val.url + '">' + val.name + '</a>').appendTo('#main-nav');
    });
</script>
<style>
    .btn-container {
        min-width: auto !important;
        padding-left: 20px;
    }
    span.kofitext {
        color: #adb5bd !important;
    }
    a.kofi-button {
        border-radius: none;
        box-shadow: none !important;
        min-width: auto !important;
        padding: 0 !important;
        line-height: unset !important;
    }
</style>
<!-- Github Corner Ribbon - to remove (Ribbon created with : http://tholman.com/github-corners/ )-->
<a href="https://github.com/teklynk/twitch_shoutout" target="_blank" class="github-corner" aria-label="View source on Github" title="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="z-index:99999; fill:#70B7FD; color:#fff; position: fixed; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}@media only screen and (max-width:680px){ .github-corner > svg { right: auto!important; left: 0!important; transform: rotate(270deg)!important;}}</style>
<!-- END Github Corner Ribbon - to remove -->
</body>
</html>